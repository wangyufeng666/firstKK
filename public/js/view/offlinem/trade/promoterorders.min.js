var t1 = null;
function loaded(){
	var ordersScroll = new IScroll('#ordersWrapper',{mouseWheel:false,click:true});
	$("#leftGoBack").on("click",function(e){
		e.preventDefault();
		if (t1 == null){
			t1 = new Date().getTime();
		}else{
			var t2 = new Date().getTime();
			if(t2 - t1 < 500){
				t1 = t2;
				return;
			}else{
				t1 = t2;
			}
		}
		window.history.back();
	});
}

//document.addEventListener('touchmove', function(e){e.preventDefault();}, false);
document.addEventListener('DOMContentLoaded', loaded, false);

function cancelOrder(orderNo,e){
	if(e && e.stopPropagation){//非IE
        e.stopPropagation();
    }else {//IE
        window.event.cancelBubble = true;
    }
	if (t1 == null){
		t1 = new Date().getTime();
	}else{
		var t2 = new Date().getTime();
		if(t2 - t1 < 500){
			t1 = t2;
			return;
		}else{
			t1 = t2;
		}
	}
	layer.open({
	    content: '<ul class="alter"><li class="alttop">提示</li><li class="altbody">是否确定取消订单？</li><ul>',
	    btn: ['确定','取消'],
	    shadeClose:false,
	    yes: function(index){
			$.post('/offlinem/trade/stoporder',{orderNo:orderNo},function(data){
				if(data == 'Y'){
					layer.open({content:'<div class="tiptext">订单取消成功</div>'});
					window.location.href = window.location.href;
				}else{
					layer.open({content:'<div class="tiptext">订单取消失败：'+data+'</div>'});
				}
			});
		},no:function(){
			layer.closeAll();
	    }
	});
}

function orderInfo(orderNo,e){
	if(e && e.stopPropagation){//非IE
        e.stopPropagation();
    }else {//IE
        window.event.cancelBubble = true;
    }
	if (t1 == null){
		t1 = new Date().getTime();
	}else{
		var t2 = new Date().getTime();
		if(t2 - t1 < 500){
			t1 = t2;
			return;
		}else{
			t1 = t2;
		}
	}
	window.location.href = '/offlinem/trade/promoterorder?orderNo='+orderNo;
}

function writeExpress(orderNo,e){
	if(e && e.stopPropagation){//非IE
        e.stopPropagation();
    }else {//IE
        window.event.cancelBubble = true;
    }
	if (t1 == null){
		t1 = new Date().getTime();
	}else{
		var t2 = new Date().getTime();
		if(t2 - t1 < 500){
			t1 = t2;
			return;
		}else{
			t1 = t2;
		}
	}
    var url = encodeURIComponent(window.location.href);
    window.location.href = '/offlinem/trade/writeexpress?orderNo='+orderNo+'&url='+url;
}

$().ready(function(){
	  var clientHeight = document.documentElement.clientHeight;
	  var headerHeight = 0;
	  var bottomHeight = 0;
	  if($('.header')){
	    headerHeight = $('.header').height();
	  }
	  if($('.btmmenu')){
	    bottomHeight = $('.btmmenu').height();
	  }
	$('#ordersArea').css({'min-height':(clientHeight-headerHeight-bottomHeight)+'px'});
    $('#navShow').click(function(e){
	  	if(e && e.stopPropagation){//非IE
	          e.stopPropagation();
	      }else {//IE
	          window.event.cancelBubble = true;
	      }
	  	if (t1 == null){
	  		t1 = new Date().getTime();
	  	}else{
	  		var t2 = new Date().getTime();
	  		if(t2 - t1 < 500){
	  			t1 = t2;
	  			return;
	  		}else{
	  			t1 = t2;
	  		}
  	  }
      document.getElementById("nav").className="nav_show";
      document.onclick = function(){
          document.getElementById("nav").className="hidden";
          document.onclick=null;
      };
    });
    $('#order_homeMenu').click(function(e){
	  	if(e && e.stopPropagation){//非IE
	          e.stopPropagation();
	      }else {//IE
	          window.event.cancelBubble = true;
	      }
	  	if (t1 == null){
	  		t1 = new Date().getTime();
	  	}else{
	  		var t2 = new Date().getTime();
	  		if(t2 - t1 < 500){
	  			t1 = t2;
	  			return;
	  		}else{
	  			t1 = t2;
	  		}
	  	}
	  	top.location.href = '/offlinem';
    });

    $('#order_ordersMenu').click(function(e){
	  	if(e && e.stopPropagation){//非IE
	          e.stopPropagation();
	      }else {//IE
	          window.event.cancelBubble = true;
	      }
	  	if (t1 == null){
	  		t1 = new Date().getTime();
	  	}else{
	  		var t2 = new Date().getTime();
	  		if(t2 - t1 < 500){
	  			t1 = t2;
	  			return;
	  		}else{
	  			t1 = t2;
	  		}
	  	}
	      window.location.href = '/offlinem/trade/index';
    });

    $('#order_question').click(function(e){
	  	if(e && e.stopPropagation){//非IE
	          e.stopPropagation();
	      }else {//IE
	          window.event.cancelBubble = true;
	      }
	  	if (t1 == null){
	  		t1 = new Date().getTime();
	  	}else{
	  		var t2 = new Date().getTime();
	  		if(t2 - t1 < 500){
	  			t1 = t2;
	  			return;
	  		}else{
	  			t1 = t2;
	  		}
	  	}
	  	window.location.href = '/offlinem/info/question';
    });
});