$().ready(function(){
	$('#stepItems .stepItem').select2Buttons({noDefault:true, sslxId:sslxId});
	$('#btn_submit').bind('click', function(){formSubmit();});
	
	var _ua = navigator.userAgent;
	_ua = _ua.toLowerCase();
	if(_ua.indexOf('iphone') > -1 && _ua.indexOf('safari') > -1){
		$('.maincontent').removeClass('androidFlag');
	}
	
});
function reset(){
	window.location.href = window.location.href;
}
//下一步
function formSubmit(){
	var index = showLoading();
	$('#btn_submit').unbind('click');
    var rIds = [];
    var cIds = [];
    var submitFlag = true;
	$("#stepItems .stepItem").each(function(i){
        var thisStepItem = $(this);
        if(thisStepItem.attr("data-type") == 'R'){//单选
          var radioId = '';
          if($('.cards .card.selected', thisStepItem).size() == 1){
        	  radioId = $('.cards .card.selected', thisStepItem).attr('id');
          }else if($('.cards .card.selected', thisStepItem).size() > 1){
        	  showError('商品描述选择有误');
              submitFlag = false;
              return false;
          }else{
        	  showError('请选择'+$('.title .text', thisStepItem).html());
              submitFlag = false;
              return false;
          }
          if(radioId != ''){
              rIds.push(radioId);
          }else{
        	  showError('请选择完整商品描述');
          }
        }else{//多选
            $('.cards .card.selected', thisStepItem).each(function(){
                cIds.push($(this).attr('id'));
            });
        }
    });
	
	if(submitFlag){
		$('#radioIds').val(rIds.join('#'));
		$('#multiIds').val(cIds.join('#'));
		$('#addForm').submit();
	}else{
		layer.close(index);
		$('#btn_submit').bind('click' ,function(){formSubmit();});
	}
}

function showError(text){
	layer.open({content:'<div class="tiptext">'+text+'</div>', time:10});
	var width = document.documentElement.clientWidth;
	var thisWidth = $('.layermmain .section').width();
	var minWidth = parseInt($('.layermmain .section').css('min-width'));
	thisWidth = thisWidth > minWidth ? thisWidth : minWidth;
	$('.layermmain .section').css({left:(width-thisWidth)/2+'px',top:'',bottom:'300px'});
}

function showLoading(){
	var index = layer.open({type:2});
	var width = document.documentElement.clientWidth;
	var thisWidth = $('.layermmain .section').width();
	var minWidth = parseInt($('.layermmain .section').css('min-width'));
	thisWidth > minWidth ? thisWidth : minWidth; 
	$('.layermmain .section').css({left:(width-thisWidth)/2+'px',top:'',bottom:'300px'});
	return index;
}
